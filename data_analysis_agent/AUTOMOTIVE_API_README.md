# Automotive Data Quality API

A comprehensive API for querying automotive data quality reports generated by the `automotive_data_quality` module.

## Overview

The Automotive Data Quality API provides a convenient interface for analyzing quality reports without needing to parse the JSON structure manually. It aggregates information from various sections of the report and provides intuitive methods to query specific columns, correlations, and quality metrics.

## Installation

The API is part of the `data_analysis_agent` package. Make sure you have the required dependencies:

```bash
pip install pandas
```

## Quick Start

```python
from data_analysis_agent.automotive_data_quality_api import AutomotiveDataQualityAPI

# Load from files
api = AutomotiveDataQualityAPI(
    report_path='report.json',
    csv_path='data.csv'  # Optional, for enhanced analysis
)

# Or load from pre-loaded data
import json
import pandas as pd

with open('report.json') as f:
    report = json.load(f)
df = pd.read_csv('data.csv')

api = AutomotiveDataQualityAPI(report_data=report, csv_data=df)
```

## Core Features

### 1. Column-Specific Analysis

Get comprehensive information about any column:

```python
# Get all information about a specific column
column_info = api.get_column_info('speedAvg')

# Get a human-readable summary
summary = api.get_column_summary('speedAvg')
print(summary)
```

The `get_column_info()` method returns a dictionary containing:
- Basic statistics (min, max, mean, std, missing values)
- Signal dictionary information (expanded name, description, units, domain)
- Range validation results (violations, expected ranges)
- Conditional signal analysis
- Stability analysis (constant values, saturation)
- Correlation information
- Quality assessment with overall score

### 2. Signal Dictionary Queries

```python
# Get signal dictionary information
signal_info = api.get_signal_dictionary_info('speedAvg')
print(f"Expanded name: {signal_info['expanded']}")
print(f"Domain: {signal_info['domain']}")
print(f"Units: {signal_info['units']}")
```

### 3. Correlation Analysis

```python
# Get all correlations
all_correlations = api.get_correlations()

# Get unexpected correlations only
unexpected = api.get_correlations(correlation_type='unexpected')

# Get correlations for a specific column
speed_correlations = api.get_correlations(column_name='speedAvg')

# Filter by correlation threshold
high_correlations = api.get_correlations(threshold=0.95)
```

### 4. Column Discovery

```python
# Search for columns by name
speed_columns = api.search_columns('speed')
temperature_columns = api.search_columns('temp')

# Search in signal descriptions
battery_signals = api.search_columns('battery', search_in='description')

# Get columns by signal type
speed_signals = api.get_columns_by_signal_type('SPEED')
rpm_signals = api.get_columns_by_signal_type('RPM')

# Get columns by domain
engine_signals = api.get_columns_by_domain('Engine')
```

### 5. Quality Issue Analysis

```python
# Find problematic columns
problems = api.get_problematic_columns(
    min_missing_pct=20.0,      # >20% missing values
    min_violation_pct=5.0,     # >5% range violations
    include_constant=True,      # Include constant-value columns
    include_saturated=True      # Include saturated sensors
)

print(f"High missing values: {problems['high_missing']}")
print(f"Range violations: {problems['range_violations']}")
print(f"Constant values: {problems['constant_values']}")
print(f"Saturated sensors: {problems['saturated']}")

# Get overall priority issues
priority_issues = api.get_priority_issues()
for issue in priority_issues:
    print(f"‚ö†Ô∏è {issue}")

# Get recommendations
recommendations = api.get_recommendations()
for rec in recommendations:
    print(f"üí° {rec}")
```

### 6. Dataset Overview

```python
# Get basic dataset statistics
stats = api.get_basic_stats()
print(f"Shape: {stats['shape']}")
print(f"Missing percentage: {stats['missing_percentage']}%")

# Get overall quality score
score = api.get_overall_quality_score()
print(f"Quality score: {score:.3f}/1.0")

# List all columns
columns = api.list_all_columns()
print(f"Total columns: {len(columns)}")
```

## Convenience Functions

For quick access without creating an API instance:

```python
from data_analysis_agent.automotive_data_quality_api import (
    load_quality_report, 
    get_column_quality_summary
)

# Quick API loading
api = load_quality_report('report.json', 'data.csv')

# Quick column summary
summary = get_column_quality_summary('report.json', 'speedAvg')
print(summary)
```

## API Reference

### Class: AutomotiveDataQualityAPI

#### Constructor
```python
AutomotiveDataQualityAPI(
    report_data: Optional[Dict[str, Any]] = None,
    report_path: Optional[Union[str, Path]] = None,
    csv_data: Optional[pd.DataFrame] = None,
    csv_path: Optional[Union[str, Path]] = None
)
```

#### Methods

| Method | Description | Returns |
|--------|-------------|---------|
| `get_column_info(column_name)` | Get comprehensive column information | `Dict[str, Any]` |
| `get_column_summary(column_name)` | Get human-readable column summary | `str` |
| `get_signal_dictionary_info(column_name)` | Get signal dictionary information | `Dict[str, str]` |
| `get_correlations(column_name, correlation_type, threshold)` | Get correlation information | `List[Dict[str, Any]]` |
| `get_columns_by_signal_type(signal_type)` | Get columns by signal type | `List[str]` |
| `get_columns_by_domain(domain)` | Get columns by domain | `List[str]` |
| `get_problematic_columns(...)` | Find problematic columns | `Dict[str, List[str]]` |
| `get_basic_stats()` | Get dataset statistics | `Dict[str, Any]` |
| `get_overall_quality_score()` | Get overall quality score | `float` |
| `get_priority_issues()` | Get priority issues | `List[str]` |
| `get_recommendations()` | Get recommendations | `List[str]` |
| `list_all_columns()` | Get all column names | `List[str]` |
| `search_columns(pattern, search_in)` | Search for columns | `List[str]` |

## Integration Examples

### Use with Jupyter Notebooks

```python
# In a Jupyter notebook
from data_analysis_agent.automotive_data_quality_api import AutomotiveDataQualityAPI

api = AutomotiveDataQualityAPI(report_path='report.json')

# Interactive exploration
for column in api.list_all_columns()[:5]:
    print(f"\n=== {column} ===")
    print(api.get_column_summary(column))
```

### Use with External Tools

```python
# Export problematic columns for further analysis
problems = api.get_problematic_columns()

# Create a summary report
import json
summary_report = {
    'quality_score': api.get_overall_quality_score(),
    'total_columns': len(api.list_all_columns()),
    'problematic_columns': problems,
    'priority_issues': api.get_priority_issues(),
    'recommendations': api.get_recommendations()
}

with open('quality_summary.json', 'w') as f:
    json.dump(summary_report, f, indent=2)
```

### Programmatic Analysis

```python
# Analyze all columns programmatically
for column in api.list_all_columns():
    info = api.get_column_info(column)
    quality_score = info['quality_assessment']['overall_score']
    
    if quality_score < 0.7:
        print(f"Low quality column: {column} (score: {quality_score:.2f})")
        
        # Get specific issues
        issues = info['quality_assessment']['issues']
        for issue in issues:
            print(f"  Issue: {issue}")
```

## Error Handling

The API provides clear error messages for common issues:

```python
try:
    info = api.get_column_info('nonexistent_column')
except KeyError as e:
    print(f"Column not found: {e}")

try:
    api = AutomotiveDataQualityAPI()  # No data provided
except ValueError as e:
    print(f"Configuration error: {e}")
```

## Performance Notes

- The API loads the entire JSON report into memory for fast querying
- Column information is aggregated on-demand, not pre-computed
- For large datasets, consider using specific query methods rather than getting all column information at once
- The original CSV data is optional and only needed for enhanced analysis features

## Compatibility

- Works with JSON reports generated by `automotive_data_quality` module version 1.3.0+
- Requires Python 3.7+
- Compatible with pandas 1.0+

## Examples in Practice

See the `notebooks/quality.ipynb` for comprehensive examples and demonstrations of all API features.
